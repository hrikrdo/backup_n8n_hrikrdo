{"createdAt":"2025-08-26T17:55:16.631Z","updatedAt":"2025-08-31T15:42:43.724Z","id":"qymvUs8Aq4siPFou","name":"Web Form Ads","active":true,"isArchived":false,"nodes":[{"parameters":{"method":"POST","url":"https://latorre180-dev-alquiler-cotizacion-22440274.dev.odoo.com/crm/webhook","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={{ JSON.stringify((() => {\n  const src = $json || {};\n\n  const get = (...paths) => {\n    for (const p of paths) {\n      const parts = p.split('.');\n      let cur = src;\n      let ok = true;\n      for (let i = 0; i < parts.length; i++) {\n        const part = parts[i];\n        // comprobación segura sin usar prototype/hasOwnProperty\n        if (cur && typeof cur === 'object' && cur[part] !== undefined && cur[part] !== null && String(cur[part]) !== '') {\n          cur = cur[part];\n        } else {\n          ok = false;\n          break;\n        }\n      }\n      if (ok) return cur;\n    }\n    return '';\n  };\n\n  const flat = {\n    // Campos mapeados del payload que envía tu WP (body.fields)\n    nombre: get('body.fields.Nombre', 'body.fields.nombre', 'body.fields.first_name', 'body.first_name'),\n    apellido: get('body.fields.Apellido', 'body.fields.apellido', 'body.fields.last_name', 'body.last_name', ''),\n    correo: get('body.fields[\"Correo electrónico\"]', 'body.fields.Correo', 'body.fields.email', 'body.email'),\n    telefono: get('body.fields.Teléfono', 'body.fields.telefono', 'body.fields.phone', 'body.phone'),\n\n    servicio: get('body.fields.Servicio', 'body.fields.servicio', 'body.servicio'),\n    producto: get('body.fields.Productos', 'body.fields.producto', 'body.producto'),\n    tamano: get('body.fields.Tamaño', 'body.fields.Tamano', 'body.fields.tamano', 'body.size'),\n    mensaje: get('body.fields.Mensaje', 'body.fields.mensaje', 'body.message'),\n\n    // UTMs si los incluyes (fallbacks)\n    utm_source: get('body.utm.utm_source','body.utm_source','body.fields.utm_source'),\n    utm_medium: get('body.utm.utm_medium','body.utm_medium','body.fields.utm_medium'),\n    utm_campaign: get('body.utm.utm_campaign','body.utm_campaign','body.fields.utm_campaign'),\n    gclid: get('body.utm.gclid','body.gclid','body.fields.gclid'),\n\n    // Metadatos y raw payload\n    page_name: get('body.form_title','body.formName','body.formTitle','page.name','data.page.name'),\n    adset_name: get('data.adset.name','adset.name','body.adset','body.fields.adset',''),\n\n    raw_payload: src,\n\n    // Exponer form id y todo el objeto body original (útil para debugging / reproducir)\n    id: get('body.form_id','body.id','params.id',''),\n    data: get('body','data','body.fields')\n  };\n\n  // construir contact_name / name (igual que en tu ejemplo)\n  const full = ((flat.nombre || '') + ' ' + (flat.apellido || '')).trim();\n  flat.contact_name = full || flat.page_name || '';\n  flat.name = flat.contact_name || flat.page_name || '';\n\n  // añadir metadatos visibles (referrer, ip, user_agent) si están en body\n  flat._referrer = get('body._referrer','body.referrer','headers.referer','headers.referrer','');\n  flat._ip = get('body._ip','body._ip','headers.x-real-ip','headers.x-forwarded-for','');\n  flat._user_agent = get('body._user_agent','headers.user-agent','');\n\n  return flat;\n})()) }}\n","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[208,0],"id":"633224f7-8fa0-43ec-94e6-161c5b03dd80","name":"HTTP Request"},{"parameters":{"httpMethod":"POST","path":"torre180","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[0,0],"id":"44b19169-c9cb-4e3b-aa04-104cbe390155","name":"Webhook","webhookId":"672e5598-264b-4f1b-a724-b3361d395d97"}],"connections":{"Webhook":{"main":[[{"node":"HTTP Request","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"ssn8n.hrikrdo.com","user-agent":"WordPress/6.8.2; https://latorre180.com","content-length":"497","accept":"*/*","accept-encoding":"deflate, gzip","content-type":"application/json","x-forwarded-for":"162.0.209.140","x-forwarded-host":"ssn8n.hrikrdo.com","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"f17169208a3d","x-real-ip":"162.0.209.140"},"params":{},"query":{},"body":{"form_id":"234","form_title":"contactenos","submitted_at":"2025-08-26 13:29:47","wp_user_id":4,"fields":{"Nombre":"Test","Correo electrónico":"test@test.com","Teléfono":"66543432","Servicio":"Alquiler","Productos":"Contenedores","Tamaño":"20 pies","Mensaje":"Test"},"_referrer":"https://latorre180.com/contactenos/","_ip":"190.141.50.180","_user_agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36"},"webhookUrl":"https://ssn8n.hrikrdo.com/webhook-test/torre180","executionMode":"test"}}]},"versionId":"fd3255be-92cc-4d8a-a568-8f9039a6fc88","triggerCount":1,"tags":[]}