{"createdAt":"2025-08-16T13:55:15.062Z","updatedAt":"2025-08-16T13:55:15.062Z","id":"hEc9uX9T7JeNvD8u","name":"My workflow 2","active":false,"isArchived":false,"nodes":[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0],"id":"6e2d18b6-3f1f-4160-8446-d4e5bc258374","name":"When clicking â€˜Test workflowâ€™"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"3fe44144-42a8-4e0d-85e8-86a26c23ed02","leftValue":"={{ $('Basic LLM Chain').item.json.output.output.recomendacion }}","rightValue":"Comprar","operator":{"type":"string","operation":"contains"}},{"id":"3c246dac-4bf9-42d9-89ae-92ee946f6d34","leftValue":"={{ $('Basic LLM Chain').item.json.output.output.recomendacion }}","rightValue":"=Vender","operator":{"type":"string","operation":"contains"}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1728,128],"id":"a97d0ae3-9d78-4f47-8d9f-b65467efe91e","name":"Solo Compra o Venta"},{"parameters":{"documentId":{"__rl":true,"value":"13DlGqXxbCsiq4VjSaiXyXLx1UyBdzUpbhojh4u7zXMA","mode":"list","cachedResultName":"Acciones","cachedResultUrl":"https://docs.google.com/spreadsheets/d/13DlGqXxbCsiq4VjSaiXyXLx1UyBdzUpbhojh4u7zXMA/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Operaciones","cachedResultUrl":"https://docs.google.com/spreadsheets/d/13DlGqXxbCsiq4VjSaiXyXLx1UyBdzUpbhojh4u7zXMA/edit#gid=0"},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[224,128],"id":"c6149f71-36fd-4df8-a168-7a81803f5b9e","name":"Acciones para Analizar","credentials":{"googleSheetsOAuth2Api":{"id":"HxJfTPIQddNNw31O","name":"Google Cloud API"}}},{"parameters":{"chatId":"-1002350171062","text":"=AcciÃ³n: *{{ $json.Accion }}*\nRecomendaciÃ³n: *{{ $json.Recomendacion }}*\nAnÃ¡lisis: {{ $json['Analisis General'] }}\nResistencia: {{ $json.Resistencia }}\nSoporte: {{ $json.Soporte }}\nPrecio de entrada: *{{ $json['Precio de entrada'] }}*\nPrecio de salida: *{{ $json['Precio de salida'] }}*\nTendencia: *{{ $json.Tendencia }}*\nGrÃ¡fica: {{ $json.URL }}","additionalFields":{}},"type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1984,32],"id":"b29c2fc4-1136-4313-a063-c269cfd35e58","name":"Telegram","webhookId":"a4129d87-c24c-4869-a45d-95e1f00a2eb4"},{"parameters":{"promptType":"define","text":"=Accion: {{ $('Mercado y Accion').item.json.ticker }} \nInforme: {{ $json.choices[0].message.content }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Eres un agente de inteligencia artificial especializado en anÃ¡lisis tÃ©cnico de acciones en mercados financieros.\n\nObjetivo:  \nRecibir un informe detallado de una acciÃ³n bursatil y devolver un JSON con la informaciÃ³n detallada, incluyendo una URL de la grÃ¡fica generada y dos precios clave: uno de entrada y otro de salida recomendados solo si la acciÃ³n tiene recomendaciÃ³n de \"âœ…Comprar\" o \"ðŸš©Vender\". Si la recomendaciÃ³n es \"â³Esperar\", devuelve \"âŒ\" para precio de entrada y de salida.\n\nInstrucciones:\n\n1. EvalÃºa y extrae para cada acciÃ³n:\n   - accion: Ticker de la acciÃ³n (ej. AAPL, TSLA, NVDA).\n   - recomendacion: \n     - \"âœ…Comprar\" si la tendencia es alcista y hay seÃ±ales de fortaleza.\n     - \"ðŸš©Vender\" si hay seÃ±ales bajistas o debilidad.\n     - \"â³Esperar\" si el mercado es incierto o lateral.\n   - analisis_general: Resumen tÃ©cnico de maximo 50 palabras.\n   - resistencia: Nivel tÃ©cnico superior relevante. Siempre ofrece este dato\n   - soporte: Nivel tÃ©cnico inferior relevante. Siempre ofrece este dato\n   - tendencia: \"Alcista\", \"Bajista\" o \"Lateral\".\n   - precio_entrada:\n     - Indicar un precio de entrada Ã³ptimo si la recomendaciÃ³n es \"âœ…Comprar\" o \"ðŸš©Vender\".\n   - precio_salida:\n     - Indicar un precio objetivo de salida para maximizar beneficios o minimizar pÃ©rdidas si la recomendaciÃ³n es \"âœ…Comprar\" o \"ðŸš©Vender\".\n\n4. Calcula los campos precio_entrada y precio_salida basÃ¡ndote en el anÃ¡lisis tÃ©cnico, buscando optimizar el ratio riesgo/beneficio y asegurando coherencia con la tendencia, el soporte y la resistencia.\n\n5. Devuelve la siguiente respuesta en formato JSON puro, sin explicaciones ni texto adicional.\n\nFormato de salida requerido (JSON):\n\n    {\n      \"accion\": \"AAPL\",\n      \"recomendacion\": \"âœ…Comprar\",\n      \"analisis_general\": \"Momentum fuerte con volumen creciente.\",\n      \"resistencia\": \"$175\",\n      \"soporte\": \"$150\",\n      \"tendencia\": \"Alcista\",\n      \"precio_entrada\": \"$158\",\n      \"precio_salida\": \"$172\"\n    }\n\nCondiciones finales:\n- No generes conclusiones ni resumen final.\n- No filtres acciones segÃºn su recomendaciÃ³n.\n- Devuelve la informaciÃ³n exclusivamente en formato JSON"}]}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[1200,128],"id":"224d25cd-4431-4f94-be9a-c181f1ba7f2a","name":"Basic LLM Chain"},{"parameters":{"assignments":{"assignments":[{"id":"cf5f7210-5b54-4f4a-abf7-87873be82df4","name":"ticker","value":"={{ $json.Mercado }}:{{ $json.Accion }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[432,128],"id":"45a1225e-397b-4121-893b-1e5245d583c9","name":"Mercado y Accion"},{"parameters":{"method":"POST","url":"https://api.chart-img.com/v2/tradingview/advanced-chart/storage","sendHeaders":true,"headerParameters":{"parameters":[{"name":"x-api-key","value":"tU11bRhssi70ycpW33kxC52C6XnEq5RdLerMln34"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"theme\": \"dark\",\n  \"interval\": \"1D\",\n  \"symbol\": \"{{ $json.ticker }}\",\n  \"override\": {\n    \"showStudyLastValue\": false\n  },\n  \"studies\": [\n    {\n      \"name\": \"Volume\",\n      \"forceOverlay\": true\n    },\n    {\n      \"name\": \"MACD\",\n      \"override\": {\n        \"Signal.linewidth\": 2,\n        \"Signal.color\": \"rgb(255,65,129)\"\n      }\n    }\n  ]\n}","options":{"response":{"response":{"responseFormat":"json"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[624,128],"id":"cc3298d2-3495-4e31-b119-20c11f9a9893","name":"Grafico"},{"parameters":{"url":"={{ $json.url }}","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[832,128],"id":"2284f996-3f6f-4ee7-b9b0-77cb8e39dd05","name":"Descarga Grafico"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"text":"=# **Rol**  \n\nEres una herramienta especializada en **anÃ¡lisis tÃ©cnico de acciones**. Tu funciÃ³n es generar un informe tÃ©cnico detallado basado en el grÃ¡fico de una acciÃ³n especÃ­fica. Este informe debe incluir informaciÃ³n clave para que el agente de anÃ¡lisis de acciones pueda interpretar los datos y emitir recomendaciones de compra, venta o espera.  \n\n## **Instrucciones**  \n\nCuando recibas un ticker de acciÃ³n, realiza un anÃ¡lisis tÃ©cnico y proporciona la siguiente informaciÃ³n estructurada:  \n\n### **1. Tendencia General**  \n   - Identifica si la tendencia es **alcista, bajista o lateral**.  \n   - Indica si hay signos de cambio de tendencia o consolidaciÃ³n.  \n\n### **2. AnÃ¡lisis de Velas Japonesas**  \n   - Detecta y explica cualquier **patrÃ³n relevante de velas** (envolvente alcista, doji, martillo, estrella fugaz, etc.).  \n   - Destaca si el patrÃ³n sugiere una continuaciÃ³n o reversiÃ³n de la tendencia.  \n\n### **3. Indicadores TÃ©cnicos**  \n   - **RSI (Ãndice de Fuerza Relativa)**: Indica si la acciÃ³n estÃ¡ **sobrecomprada (>70), sobrevendida (<30) o en zona neutra**.  \n   - **MACD (Media MÃ³vil de Convergencia/Divergencia)**: Explica si hay un **cruce alcista, cruce bajista o divergencia con el precio**.  \n   - **Medias MÃ³viles**: Indica si el precio estÃ¡ por encima o por debajo de la **media mÃ³vil de 50 y 200 dÃ­as**.  \n   - **Bandas de Bollinger**: EvalÃºa si el precio estÃ¡ en la banda superior, inferior o en el centro, indicando posible volatilidad.  \n\n### **4. AnÃ¡lisis de Volumen**  \n   - Compara el **volumen actual con el promedio** de los Ãºltimos perÃ­odos.  \n   - Identifica si hay **volumen creciente o decreciente** en relaciÃ³n con el precio.  \n   - Destaca si hubo **picos de volumen que indiquen actividad institucional**.  \n\n### **5. Soportes y Resistencias**  \n   - Indica los niveles clave de **soporte y resistencia** en los Ãºltimos perÃ­odos.  \n   - EvalÃºa si el precio estÃ¡ cerca de romper un nivel importante.  \n   - Comenta si la acciÃ³n estÃ¡ operando en un **rango definido o en niveles de ruptura**.  \n\n### **6. Factores de Mercado**  \n   - Menciona cualquier **evento reciente** que pueda influir en el precio (resultados financieros, noticias sectoriales, cambios regulatorios).  \n   - EvalÃºa el **sentimiento del mercado** en relaciÃ³n con la acciÃ³n (optimismo, incertidumbre, presiÃ³n bajista).  \n\n### **7. InformaciÃ³n Procesable**  \n   - Resume los hallazgos clave del anÃ¡lisis.  \n   - Indica los niveles a vigilar y las seÃ±ales que pueden confirmar una prÃ³xima tendencia.  \n\nðŸ“¢ **Formato de salida:**  \nEl anÃ¡lisis debe ser **estructurado y claro**, asegurando que el agente pueda interpretarlo correctamente y emitir recomendaciones adecuadas.","inputType":"base64","simplify":false,"options":{"detail":"auto","maxTokens":4000}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[1024,128],"id":"c49078b2-a352-4484-ab73-ace516ef9daf","name":"Analisis Tecnico"},{"parameters":{"options":{"responseFormat":"json_object"}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.1,"position":[1120,368],"id":"f86ac6f2-ccd5-4fc1-9842-f3fd60f4d61b","name":"OpenAI Chat Model1"},{"parameters":{"jsonSchemaExample":"{\n  \"output\": {\n    \"accion\": \"AAPL\",\n    \"recomendacion\": \"âœ…Comprar\",\n    \"analisis_general\": \"Momentum fuerte con volumen creciente.\",\n    \"resistencia\": \"$175\",\n    \"soporte\": \"$150\",\n    \"tendencia\": \"Alcista\",\n    \"precio_entrada\": \"$158\",\n    \"precio_salida\": \"$172\"\n  }\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[1408,320],"id":"c4f08a4b-a430-4621-a033-dfa693e07a08","name":"Structured Output Parser1","notesInFlow":false},{"parameters":{"operation":"append","documentId":{"__rl":true,"value":"1AFS4--yEIFYtOUqwelyi90BDOmNZvwZ22osrLi2Xs5o","mode":"list","cachedResultName":"Acciones","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AFS4--yEIFYtOUqwelyi90BDOmNZvwZ22osrLi2Xs5o/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Calculos","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1AFS4--yEIFYtOUqwelyi90BDOmNZvwZ22osrLi2Xs5o/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Fecha":"={{ $now.format('dd-MM-yyyy') }}","Accion":"={{ $json.output.output.accion }}","Recomendacion":"={{ $json.output.output.recomendacion }}","Analisis General":"={{ $json.output.output.analisis_general }}","Resistencia":"={{ $json.output.output.resistencia }}","Soporte":"={{ $json.output.output.soporte }}","Tendencia":"={{ $json.output.output.tendencia }}","Precio de entrada":"={{ $json.output.output.precio_entrada }}","Precio de salida":"={{ $json.output.output.precio_salida }}","URL":"={{ $('Descarga Grafico').item.json.url }}"},"matchingColumns":[],"schema":[{"id":"Fecha","displayName":"Fecha","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Accion","displayName":"Accion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Recomendacion","displayName":"Recomendacion","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Analisis General","displayName":"Analisis General","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Resistencia","displayName":"Resistencia","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Soporte","displayName":"Soporte","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Precio de entrada","displayName":"Precio de entrada","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Precio de salida","displayName":"Precio de salida","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Tendencia","displayName":"Tendencia","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"URL","displayName":"URL","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1552,128],"id":"6b4ee34e-1025-4dd4-af3b-911b3e127983","name":"Google Sheets"},{"parameters":{"rule":{"interval":[{"triggerAtHour":10,"triggerAtMinute":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[0,192],"id":"751ecf01-47cf-4ec7-8751-1d44ad507e8b","name":"Schedule Trigger"}],"connections":{"When clicking â€˜Test workflowâ€™":{"main":[[{"node":"Acciones para Analizar","type":"main","index":0}]]},"Solo Compra o Venta":{"main":[[{"node":"Telegram","type":"main","index":0}]]},"Acciones para Analizar":{"main":[[{"node":"Mercado y Accion","type":"main","index":0}]]},"Mercado y Accion":{"main":[[{"node":"Grafico","type":"main","index":0}]]},"Grafico":{"main":[[{"node":"Descarga Grafico","type":"main","index":0}]]},"Descarga Grafico":{"main":[[{"node":"Analisis Tecnico","type":"main","index":0}]]},"Analisis Tecnico":{"main":[[{"node":"Basic LLM Chain","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Basic LLM Chain","type":"ai_languageModel","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Basic LLM Chain","type":"ai_outputParser","index":0}]]},"Basic LLM Chain":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Google Sheets":{"main":[[{"node":"Solo Compra o Venta","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Acciones para Analizar","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":null,"pinData":{},"versionId":"604af18f-f4ee-44d8-a43c-f01366fcb1f4","triggerCount":0,"tags":[]}